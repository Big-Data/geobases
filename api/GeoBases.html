

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GeoBases Package &mdash; GeoBases 4 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="GeoBases 4 documentation" href="index.html" />
    <link rel="up" title="API documentation" href="modules.html" />
    <link rel="prev" title="GeoBaseMain Module" href="GeoBaseMain.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="GeoBaseMain.html" title="GeoBaseMain Module"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">GeoBases 4 documentation</a> &raquo;</li>
          <li><a href="modules.html" accesskey="U">API documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="geobases-package">
<h1>GeoBases Package<a class="headerlink" href="#geobases-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2><a class="reference internal" href="#module-GeoBases" title="GeoBases"><tt class="xref py py-mod docutils literal"><span class="pre">GeoBases</span></tt></a> Package<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<span class="target" id="module-GeoBases"></span><p>This is the GeoBase module.</p>
<dl class="class">
<dt id="GeoBases.GeoBase">
<em class="property">class </em><tt class="descclassname">GeoBases.</tt><tt class="descname">GeoBase</tt><big>(</big><em>data</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<p>This is the main and only class. After __init__,
a file is loaded in memory, and the user may use
the instance to get information.</p>
<dl class="method">
<dt id="GeoBases.GeoBase.biasFuzzyCache">
<tt class="descname">biasFuzzyCache</tt><big>(</big><em>fuzzy_value</em>, <em>field</em>, <em>approximate</em>, <em>min_match</em>, <em>biased_result</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.biasFuzzyCache" title="Permalink to this definition">¶</a></dt>
<dd><p>If algorithms for fuzzy searches are failing on a single example,
it is possible to use a first cache which will block
the research and force the result.</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.clearBiasCache">
<tt class="descname">clearBiasCache</tt><big>(</big><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.clearBiasCache" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear biasing cache for fuzzy searches.</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.clearCache">
<tt class="descname">clearCache</tt><big>(</big><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.clearCache" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear cache for fuzzy searches.</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.createGrid">
<tt class="descname">createGrid</tt><big>(</big><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.createGrid" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the grid for geographical indexation after loading the data.</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.delete">
<tt class="descname">delete</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to manually remove a value in the base.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> &#8211; the key we want to change a value of</li>
<li><strong>field</strong> &#8211; the concerned field, like &#8216;name&#8217;</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frxrn&#39;</span><span class="p">)</span> <span class="c"># Output all data in one dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;frxrn&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frxrn&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">KeyError: &#39;Thing not found</span>: <span class="n">frxrn&#39;</span>
</pre></div>
</div>
<p>How to reverse the delete if data has been stored:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">setWithDict</span><span class="p">(</span><span class="s">&#39;frxrn&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frxrn&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">&#39;Redon&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.distance">
<tt class="descname">distance</tt><big>(</big><em>key0</em>, <em>key1</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.distance" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute distance between two elements.</p>
<p>This is just a wrapper between the original haversine
function, but it is probably the most used feature :)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key0</strong> &#8211; the first key</li>
<li><strong>key1</strong> &#8211; the second key</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the distance (km)</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;frpaz&#39;</span><span class="p">)</span>
<span class="go">683.526...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.findClosestFromPoint">
<tt class="descname">findClosestFromPoint</tt><big>(</big><em>lat_lng</em>, <em>N=1</em>, <em>from_keys=None</em>, <em>grid=True</em>, <em>double_check=True</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.findClosestFromPoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Concept close to findNearPoint, but here we do not
look for the things radius-close to a point,
we look for the closest thing from this point, given by
latitude/longitude.</p>
<p>Note that a similar implementation is done in
the LocalHelper, to find efficiently N closest point
in a graph, from a point (using heaps).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lat_lng</strong> &#8211; the lat_lng of the point</li>
<li><strong>N</strong> &#8211; the N closest results wanted</li>
<li><strong>from_keys</strong> &#8211; if None, it takes all keys in consideration, else takes from_keys             iterable of keys to perform findClosestFromPoint. This is useful when we have names             and have to perform a matching based on name and location (see fuzzyGetAroundLatLng).</li>
<li><strong>grid</strong> &#8211; boolean, use grid or not</li>
<li><strong>double_check</strong> &#8211; when using grid, perform an additional check on results distance</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">one key (like &#8216;SFO&#8217;), or a list if approximate is not None</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">)))</span> <span class="c"># Nice</span>
<span class="go">[(5.82..., &#39;NCE&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span> <span class="c"># Nice</span>
<span class="go">[(5.82..., &#39;NCE&#39;), (30.28..., &#39;CEQ&#39;), (79.71..., &#39;ALL&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="c"># Nice</span>
<span class="go">[(0.56..., &#39;frnic&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Corner case, from_keys empty is not used</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">from_keys</span><span class="o">=</span><span class="p">()))</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#from datetime import datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#before = datetime.now()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#for _ in range(100): s = geo_a.findClosestFromPoint((43.70, 7.26), N=3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#print(datetime.now() - before)</span>
</pre></div>
</div>
<p>No grid.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span> <span class="c"># Nice</span>
<span class="go">[(0.60..., &#39;NCE@1&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span> <span class="c"># Nice</span>
<span class="go">[(5.82..., &#39;NCE&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span> <span class="c"># Nice</span>
<span class="go">[(5.82..., &#39;NCE&#39;), (30.28..., &#39;CEQ&#39;), (79.71..., &#39;ALL&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span> <span class="c"># Nice</span>
<span class="go">[(0.56..., &#39;frnic&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">from_keys</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;frpaz&#39;</span><span class="p">,</span> <span class="s">&#39;frply&#39;</span><span class="p">,</span> <span class="s">&#39;frbve&#39;</span><span class="p">)))</span>
<span class="go">[(482.84..., &#39;frbve&#39;), (683.89..., &#39;frpaz&#39;)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.findNearKey">
<tt class="descname">findNearKey</tt><big>(</big><em>key</em>, <em>radius=50</em>, <em>from_keys=None</em>, <em>grid=True</em>, <em>double_check=True</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.findNearKey" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as findNearPoint, except the point is given
not by a lat/lng, but with its key, like ORY or SFO.
We just look up in the base to retrieve lat/lng, and
call findNearPoint.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> &#8211; the key of the point</li>
<li><strong>radius</strong> &#8211; the radius of the search (kilometers)</li>
<li><strong>from_keys</strong> &#8211; if None, it takes all keys in consideration, else takes from_keys             iterable of keys to perform search.</li>
<li><strong>grid</strong> &#8211; boolean, use grid or not</li>
<li><strong>double_check</strong> &#8211; when using grid, perform an additional check on results distance</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a list of keys of things (like [&#8216;ORY&#8217;, &#8216;CDG&#8217;])</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="c"># Orly, por &lt;= 10km</span>
<span class="go">[(0.0, &#39;ORY&#39;), (1.82..., &#39;JDP&#39;), (8.06..., &#39;XJY&#39;), (9.95..., &#39;QFC&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span> <span class="c"># Orly, airports &lt;= 50km</span>
<span class="go">[(0.0, &#39;ORY&#39;), (18.8..., &#39;TNF&#39;), (27.8..., &#39;LBG&#39;), (34.8..., &#39;CDG&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="c"># Nice station, stations &lt;= 5km</span>
<span class="go">[(0.0, &#39;frnic&#39;), (2.2..., &#39;fr4342&#39;), (2.3..., &#39;fr5737&#39;), (4.1..., &#39;fr4708&#39;), (4.5..., &#39;fr6017&#39;)]</span>
</pre></div>
</div>
<p>No grid.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Orly, airports &lt;= 50km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
<span class="go">[(0.0, &#39;ORY&#39;), (18.8..., &#39;TNF&#39;), (27.8..., &#39;LBG&#39;), (34.8..., &#39;CDG&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Nice station, stations &lt;= 5km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
<span class="go">[(0.0, &#39;frnic&#39;), (2.2..., &#39;fr4342&#39;), (2.3..., &#39;fr5737&#39;), (4.1..., &#39;fr4708&#39;), (4.5..., &#39;fr6017&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">from_keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="s">&#39;CDG&#39;</span><span class="p">,</span> <span class="s">&#39;SFO&#39;</span><span class="p">]))</span>
<span class="go">[(0.0, &#39;ORY&#39;), (34.8..., &#39;CDG&#39;)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.findNearPoint">
<tt class="descname">findNearPoint</tt><big>(</big><em>lat_lng</em>, <em>radius=50</em>, <em>from_keys=None</em>, <em>grid=True</em>, <em>double_check=True</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.findNearPoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of nearby things from a point (given
latidude and longitude), and a radius for the search.
Note that the haversine function, which compute distance
at the surface of a sphere, here returns kilometers,
so the radius should be in kms.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lat_lng</strong> &#8211; the lat_lng of the point</li>
<li><strong>radius</strong> &#8211; the radius of the search (kilometers)</li>
<li><strong>from_keys</strong> &#8211; if None, it takes all keys in consideration, else takes from_keys             iterable of keys to perform search.</li>
<li><strong>grid</strong> &#8211; boolean, use grid or not</li>
<li><strong>double_check</strong> &#8211; when using grid, perform an additional check on results distance</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">an iterable of keys of things (like [&#8216;ORY&#8217;, &#8216;CDG&#8217;])</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Paris, airports &lt;= 50km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">geo_a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findNearPoint</span><span class="p">((</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">),</span> <span class="mi">50</span><span class="p">))]</span>
<span class="go">[&#39;Paris-Orly&#39;, &#39;Paris-Le Bourget&#39;, &#39;Toussus-le-Noble&#39;, &#39;Paris - Charles-de-Gaulle&#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Nice, stations &lt;= 5km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findNearPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="mi">5</span><span class="p">))]</span>
<span class="go">[&#39;Nice-Ville&#39;, &#39;Nice-Riquier&#39;, &#39;Nice-St-Roch&#39;, &#39;Villefranche-sur-Mer&#39;, &#39;Nice-St-Augustin&#39;]</span>
</pre></div>
</div>
<p>No grid mode.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Paris, airports &lt;= 50km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">geo_a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findNearPoint</span><span class="p">((</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">),</span> <span class="mi">50</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))]</span>
<span class="go">[&#39;Paris-Orly&#39;, &#39;Paris-Le Bourget&#39;, &#39;Toussus-le-Noble&#39;, &#39;Paris - Charles-de-Gaulle&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Nice, stations &lt;= 5km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findNearPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))]</span>
<span class="go">[&#39;Nice-Ville&#39;, &#39;Nice-Riquier&#39;, &#39;Nice-St-Roch&#39;, &#39;Villefranche-sur-Mer&#39;, &#39;Nice-St-Augustin&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Paris, airports &lt;= 50km with from_keys input list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findNearPoint</span><span class="p">((</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">),</span> <span class="mi">50</span><span class="p">,</span> <span class="n">from_keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="s">&#39;CDG&#39;</span><span class="p">,</span> <span class="s">&#39;BVE&#39;</span><span class="p">],</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
<span class="go">[(12.76..., &#39;ORY&#39;), (23.40..., &#39;CDG&#39;)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.fuzzyGet">
<tt class="descname">fuzzyGet</tt><big>(</big><em>fuzzy_value</em>, <em>field</em>, <em>approximate=None</em>, <em>min_match=0.75</em>, <em>from_keys=None</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.fuzzyGet" title="Permalink to this definition">¶</a></dt>
<dd><p>We get to the cool stuff.</p>
<p>Fuzzy searches are retrieving an information
on a thing when we do not know the code.
We compare the value fuzzy_value which is supposed to be a field
(e.g. a city or a name), to all things we have in the base,
and we output the best match.
Matching is performed using Levenshtein module, with a modified
version of the Lenvenshtein ratio, adapted to the type of data.</p>
<p>Example: we look up &#8216;Marseille Saint Ch.&#8217; in our base
and we find the corresponding code by comparing all station
names with &#8216;&#8217;Marseille Saint Ch.&#8217;&#8216;.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fuzzy_value</strong> &#8211; the value, like &#8216;Marseille&#8217;</li>
<li><strong>field</strong> &#8211; the field we look into, like &#8216;name&#8217;</li>
<li><strong>approximate</strong> &#8211; max number of results, None means all results</li>
<li><strong>min_match</strong> &#8211; filter out matches under this threshold</li>
<li><strong>from_keys</strong> &#8211; if None, it takes all keys in consideration, else takes from_keys             iterable of keys to perform fuzzyGet. This is useful when we have geocodes             and have to perform a matching based on name and location (see fuzzyGetAroundLatLng).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a couple with the best match and the distance found</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;Marseille Charles&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0.8..., &#39;frmsc&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0.78..., &#39;CDG&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.55</span><span class="p">)</span>
<span class="go">[(0.78..., &#39;CDG&#39;), (0.60..., &#39;HUX&#39;), (0.57..., &#39;LBG&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="go">[(0.78..., &#39;CDG&#39;)]</span>
</pre></div>
</div>
<p>Some corner cases.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="bp">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0.78..., &#39;CDG&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">from_keys</span><span class="o">=</span><span class="p">[])</span>
<span class="go">[]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.fuzzyGetAroundLatLng">
<tt class="descname">fuzzyGetAroundLatLng</tt><big>(</big><em>lat_lng</em>, <em>radius</em>, <em>fuzzy_value</em>, <em>field</em>, <em>approximate=None</em>, <em>min_match=0.75</em>, <em>from_keys=None</em>, <em>grid=True</em>, <em>double_check=True</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.fuzzyGetAroundLatLng" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as fuzzyGet but with we search only within a radius
from a geocode.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>lat_lng</strong> &#8211; the lat_lng of the point</li>
<li><strong>radius</strong> &#8211; the radius of the search (kilometers)</li>
<li><strong>fuzzy_value</strong> &#8211; the value, like &#8216;Marseille&#8217;</li>
<li><strong>field</strong> &#8211; the field we look into, like &#8216;name&#8217;</li>
<li><strong>approximate</strong> &#8211; if None, returns the best, if an int, returns a list of             n best matches</li>
<li><strong>from_keys</strong> &#8211; if None, it takes all keys in consideration, else takes from_keys             iterable of keys to perform search.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;Brussels&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.60</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0.61..., &#39;BQT&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;BQT&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>  <span class="c"># Brussels just matched on Brest!!</span>
<span class="go">&#39;Brest&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;BRU&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="c"># We wanted BRU for &#39;Bruxelles&#39;</span>
<span class="go">&#39;Bruxelles National&#39;</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Now a request limited to a circle of 20km around BRU gives BRU</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGetAroundLatLng</span><span class="p">((</span><span class="mf">50.9013890</span><span class="p">,</span> <span class="mf">4.4844440</span><span class="p">),</span> <span class="mi">20</span><span class="p">,</span> <span class="s">&#39;Brussels&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.40</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0.46..., &#39;BRU&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Now a request limited to some input keys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGetAroundLatLng</span><span class="p">((</span><span class="mf">50.9013890</span><span class="p">,</span> <span class="mf">4.4844440</span><span class="p">),</span> <span class="mi">2000</span><span class="p">,</span> <span class="s">&#39;Brussels&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.30</span><span class="p">,</span> <span class="n">from_keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;CDG&#39;</span><span class="p">,</span> <span class="s">&#39;ORY&#39;</span><span class="p">])</span>
<span class="go">[(0.33..., &#39;ORY&#39;)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.fuzzyGetCached">
<tt class="descname">fuzzyGetCached</tt><big>(</big><em>fuzzy_value</em>, <em>field</em>, <em>approximate=None</em>, <em>min_match=0.75</em>, <em>verbose=True</em>, <em>show_bad=(1</em>, <em>1)</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.fuzzyGetCached" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as fuzzyGet but with a caching and bias system.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fuzzy_value</strong> &#8211; the value, like &#8216;Marseille&#8217;</li>
<li><strong>field</strong> &#8211; the field we look into, like &#8216;name&#8217;</li>
<li><strong>approximate</strong> &#8211; if None, returns the best, if an int, returns a list of             n best matches</li>
<li><strong>verbose</strong> &#8211; display a certain range of similarity</li>
<li><strong>show_bad</strong> &#8211; the range of similarity</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the best match</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">fuzzyGetCached</span><span class="p">(</span><span class="s">&#39;Marseille Saint Ch.&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0.8..., &#39;frmsc&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGetCached</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">show_bad</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">[0.79]           paris+de+gaulle -&gt;   paris+charles+de+gaulle (  CDG)</span>
<span class="go">(0.78..., &#39;CDG&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGetCached</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.60</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">show_bad</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="go">[0.79]           paris+de+gaulle -&gt;   paris+charles+de+gaulle (  CDG)</span>
<span class="go">[0.61]           paris+de+gaulle -&gt;        bahias+de+huatulco (  HUX)</span>
<span class="go">[(0.78..., &#39;CDG&#39;), (0.60..., &#39;HUX&#39;)]</span>
</pre></div>
</div>
<p>Some biasing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">biasFuzzyCache</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="p">[(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s">&#39;Biased result&#39;</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGetCached</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">show_bad</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># Cache there</span>
<span class="go">(0.78..., &#39;CDG&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGetCached</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="go">Using bias: (&#39;paris+de+gaulle&#39;, &#39;name&#39;, None, 0.75)</span>
<span class="go">[(0.5, &#39;Biased result&#39;)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.get">
<tt class="descname">get</tt><big>(</big><em>key</em>, <em>field=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple get on the base.</p>
<p>This get function raises an exception when input is not correct.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> &#8211; the key of the thing (like &#8216;SFO&#8217;)</li>
<li><strong>field</strong> &#8211; the field (like &#8216;name&#8217; or &#8216;iata_code&#8217;)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises :</th><td class="field-body"><p class="first">KeyError, if the key is not in the base</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the needed information</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CDG&#39;</span><span class="p">,</span> <span class="s">&#39;city_code&#39;</span><span class="p">)</span>
<span class="go">&#39;PAR&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">&#39;Nice-Ville&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">)</span>
<span class="go">{&#39;info&#39;: &#39;Desserte Voyageur-Infrastructure&#39;, &#39;code&#39;: &#39;frnic&#39;, ...}</span>
</pre></div>
</div>
<p>Cases of unknown key.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frmoron&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;There&#39;</span><span class="p">)</span>
<span class="go">&#39;There&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frmoron&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">KeyError: &#39;Thing not found</span>: <span class="n">frmoron&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frmoron&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frmoron&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;There&#39;</span><span class="p">)</span>
<span class="go">&#39;There&#39;</span>
</pre></div>
</div>
<p>Cases of unknown field, this is a bug and always fail.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;not_a_field&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;There&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">KeyError</span>: <span class="n">&quot;Field &#39;not_a_field&#39; [for key &#39;frnic&#39;] not in [&#39;info&#39;, &#39;code&#39;, &#39;name&#39;, &#39;lines@raw&#39;, &#39;lines&#39;, &#39;__gar__&#39;, &#39;__par__&#39;, &#39;__dup__&#39;, &#39;__key__&#39;, &#39;lat&#39;, &#39;lng&#39;, &#39;__lno__&#39;]&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.getAllDuplicates">
<tt class="descname">getAllDuplicates</tt><big>(</big><em>key</em>, <em>field=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.getAllDuplicates" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all duplicates data, parent key included.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">getAllDuplicates</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">[&#39;Paris-Orly&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">getAllDuplicates</span><span class="p">(</span><span class="s">&#39;THA&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">[&#39;Tullahoma Regional Airport/William Northern Field&#39;, &#39;Tullahoma&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">getAllDuplicates</span><span class="p">(</span><span class="s">&#39;THA&#39;</span><span class="p">,</span> <span class="s">&#39;__key__&#39;</span><span class="p">)</span>
<span class="go">[&#39;THA&#39;, &#39;THA@1&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">getAllDuplicates</span><span class="p">(</span><span class="s">&#39;THA@1&#39;</span><span class="p">,</span> <span class="s">&#39;__key__&#39;</span><span class="p">)</span>
<span class="go">[&#39;THA@1&#39;, &#39;THA&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;THA&#39;</span><span class="p">,</span> <span class="s">&#39;__dup__&#39;</span><span class="p">)</span>
<span class="go">[&#39;THA@1&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.getKeysWhere">
<tt class="descname">getKeysWhere</tt><big>(</big><em>conditions</em>, <em>from_keys=None</em>, <em>reverse=False</em>, <em>force_str=False</em>, <em>mode='and'</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.getKeysWhere" title="Permalink to this definition">¶</a></dt>
<dd><p>Get iterator of all keys with particular field.</p>
<p>For example, if you want to know all airports in Paris.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>conditions</strong> &#8211; a list of (field, value) conditions</li>
<li><strong>reverse</strong> &#8211; we look keys where the field is <em>not</em> the particular value</li>
<li><strong>force_str</strong> &#8211; for the str() method before every test</li>
<li><strong>mode</strong> &#8211; either &#8216;or&#8217; or &#8216;and&#8217;, how to handle several conditions</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">an iterator of matching keys</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;city_code&#39;</span><span class="p">,</span> <span class="s">&#39;PAR&#39;</span><span class="p">)]))</span>
<span class="go">[&#39;ORY&#39;, &#39;TNF&#39;, &#39;CDG&#39;, &#39;BVA&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;comment&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;__dup__&#39;</span><span class="p">,</span> <span class="s">&#39;[]&#39;</span><span class="p">)]))</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;__dup__&#39;</span><span class="p">,</span> <span class="p">[])])))</span>
<span class="go">7025</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;__dup__&#39;</span><span class="p">,</span> <span class="s">&#39;[]&#39;</span><span class="p">)],</span> <span class="n">force_str</span><span class="o">=</span><span class="bp">True</span><span class="p">)))</span>
<span class="go">7025</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;__par__&#39;</span><span class="p">,</span> <span class="p">[])],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)))</span> <span class="c"># Counting duplicated keys</span>
<span class="go">4431</span>
</pre></div>
</div>
<p>Testing several conditions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c_1</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;city_code&#39;</span>    <span class="p">,</span> <span class="s">&#39;PAR&#39;</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c_2</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;location_type&#39;</span><span class="p">,</span> <span class="s">&#39;H&#39;</span>  <span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">(</span><span class="n">c_1</span><span class="p">)))</span>
<span class="go">18</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">(</span><span class="n">c_2</span><span class="p">)))</span>
<span class="go">91</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">(</span><span class="n">c_1</span> <span class="o">+</span> <span class="n">c_2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;and&#39;</span><span class="p">)))</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">(</span><span class="n">c_1</span> <span class="o">+</span> <span class="n">c_2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;or&#39;</span><span class="p">)))</span>
<span class="go">107</span>
</pre></div>
</div>
<p>This works too o/.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;city_code&#39;</span><span class="p">,</span> <span class="s">&#39;PAR&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;city_code&#39;</span><span class="p">,</span> <span class="s">&#39;BVE&#39;</span><span class="p">)],</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;and&#39;</span><span class="p">)))</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;city_code&#39;</span><span class="p">,</span> <span class="s">&#39;PAR&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;city_code&#39;</span><span class="p">,</span> <span class="s">&#39;BVE&#39;</span><span class="p">)],</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;or&#39;</span><span class="p">)))</span>
<span class="go">20</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.getLocation">
<tt class="descname">getLocation</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.getLocation" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns geocode as (float, float) or None.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">getLocation</span><span class="p">(</span><span class="s">&#39;AGN&#39;</span><span class="p">)</span>
<span class="go">(57.50..., -134.585...)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.hasDuplicates">
<tt class="descname">hasDuplicates</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.hasDuplicates" title="Permalink to this definition">¶</a></dt>
<dd><p>Tell if a key has duplicates.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">hasDuplicates</span><span class="p">(</span><span class="s">&#39;MRS&#39;</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">hasDuplicates</span><span class="p">(</span><span class="s">&#39;MRS@1&#39;</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">hasDuplicates</span><span class="p">(</span><span class="s">&#39;PAR&#39;</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.hasGeoSupport">
<tt class="descname">hasGeoSupport</tt><big>(</big><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.hasGeoSupport" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if data type has geocoding support.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">hasGeoSupport</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_f</span><span class="o">.</span><span class="n">hasGeoSupport</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.hasParents">
<tt class="descname">hasParents</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.hasParents" title="Permalink to this definition">¶</a></dt>
<dd><p>Tell if a key has parents.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">hasParents</span><span class="p">(</span><span class="s">&#39;MRS&#39;</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">hasParents</span><span class="p">(</span><span class="s">&#39;MRS@1&#39;</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">hasParents</span><span class="p">(</span><span class="s">&#39;PAR&#39;</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="GeoBases.GeoBase.hasTrepSupport">
<em class="property">static </em><tt class="descname">hasTrepSupport</tt><big>(</big><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.hasTrepSupport" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if module has OpenTrep support.</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.keys">
<tt class="descname">keys</tt><big>(</big><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of all keys in the base.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the list of all keys</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;AGN&#39;, &#39;AGM&#39;, &#39;AGJ&#39;, &#39;AGH&#39;, ...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.set">
<tt class="descname">set</tt><big>(</big><em>key</em>, <em>field</em>, <em>value</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.set" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to manually change a value in the base.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> &#8211; the key we want to change a value of</li>
<li><strong>field</strong> &#8211; the concerned field, like &#8216;name&#8217;</li>
<li><strong>value</strong> &#8211; the new value</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">&#39;Nice-Ville&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;Nice Gare SNCF&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">&#39;Nice Gare SNCF&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;Nice-Ville&#39;</span><span class="p">)</span> <span class="c"># Not to mess with other tests :)</span>
</pre></div>
</div>
<p>We may even add new fields.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;new_field&#39;</span><span class="p">,</span> <span class="s">&#39;some_value&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;new_field&#39;</span><span class="p">)</span>
<span class="go">&#39;some_value&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.setWithDict">
<tt class="descname">setWithDict</tt><big>(</big><em>key</em>, <em>dictionary</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.setWithDict" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as set method, except we perform
the input with a whole dictionary.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> &#8211; the key we want to change a value of</li>
<li><strong>dictionary</strong> &#8211; the dict containing the new data</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_f</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_f</span><span class="o">.</span><span class="n">setWithDict</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;code&#39;</span> <span class="p">:</span> <span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Nice&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_f</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;frnic&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="GeoBases.GeoBase.trepGet">
<em class="property">static </em><tt class="descname">trepGet</tt><big>(</big><em>fuzzy_value</em>, <em>trep_format='S'</em>, <em>from_keys=None</em>, <em>verbose=False</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.trepGet" title="Permalink to this definition">¶</a></dt>
<dd><p>OpenTrep integration.</p>
<p>If not hasTrepSupport(), main_trep is not defined
and trepGet will raise an exception if called.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">geo_t</span><span class="o">.</span><span class="n">hasTrepSupport</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">geo_t</span><span class="o">.</span><span class="n">trepGet</span><span class="p">(</span><span class="s">&#39;sna francisco los agneles&#39;</span><span class="p">)</span> 
<span class="go">[(31.5192, &#39;SFO&#39;), (46.284, &#39;LAX&#39;)]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">geo_t</span><span class="o">.</span><span class="n">hasTrepSupport</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">geo_t</span><span class="o">.</span><span class="n">trepGet</span><span class="p">(</span><span class="s">&#39;sna francisco&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> 
<span class="go"> -&gt; Raw result: SFO/31.5192</span>
<span class="go"> -&gt; Fmt result: ([(31.5192, &#39;SFO&#39;)], &#39;&#39;)</span>
<span class="go">[(31.5192, &#39;SFO&#39;)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="GeoBases.GeoBase.update">
<em class="property">static </em><tt class="descname">update</tt><big>(</big><em>force=False</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Launch update script on data files.</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBase.visualize">
<tt class="descname">visualize</tt><big>(</big><em>output='example'</em>, <em>label='__key__'</em>, <em>point_size=None</em>, <em>point_color=None</em>, <em>icon_type='auto'</em>, <em>from_keys=None</em>, <em>catalog=None</em>, <em>add_lines=None</em>, <em>link_duplicates=True</em>, <em>verbose=True</em><big>)</big><a class="headerlink" href="#GeoBases.GeoBase.visualize" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates map and other visualizations.</p>
<p>Returns list of templates successfully rendered.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-GeoBases.GeoBaseModule">
<span id="geobasemodule-module"></span><h2><tt class="xref py py-mod docutils literal"><span class="pre">GeoBaseModule</span></tt> Module<a class="headerlink" href="#module-GeoBases.GeoBaseModule" title="Permalink to this headline">¶</a></h2>
<p>This module is a general class <em>GeoBase</em> to manipulate geographical
data. It loads static csv files containing data about
airports or train stations, and then provides tools to browse it.</p>
<p>It relies on two other modules:</p>
<blockquote>
<div><ul class="simple">
<li>GeoUtils: to compute haversine distances between points</li>
<li>LevenshteinUtils: to calculate distances between strings. Indeed, we need
a good tool to do it, in order to recognize things like station names
in schedule files where we do not have the station id</li>
</ul>
</div></blockquote>
<p>Examples for airports:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span> <span class="o">=</span> <span class="n">GeoBase</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s">&#39;airports&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span> <span class="c"># Orly, airports &lt;= 50km</span>
<span class="go">[(0.0, &#39;ORY&#39;), (18.8..., &#39;TNF&#39;), (27.8..., &#39;LBG&#39;), (34.8..., &#39;CDG&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CDG&#39;</span><span class="p">,</span> <span class="s">&#39;city_code&#39;</span><span class="p">)</span>
<span class="go">&#39;PAR&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="s">&#39;CDG&#39;</span><span class="p">,</span> <span class="s">&#39;NCE&#39;</span><span class="p">)</span>
<span class="go">694.5162...</span>
</pre></div>
</div>
<p>Examples for stations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span> <span class="o">=</span> <span class="n">GeoBase</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s">&#39;stations&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Nice, stations &lt;= 5km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findNearPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="mi">5</span><span class="p">))]</span>
<span class="go">[&#39;Nice-Ville&#39;, &#39;Nice-Riquier&#39;, &#39;Nice-St-Roch&#39;, &#39;Villefranche-sur-Mer&#39;, &#39;Nice-St-Augustin&#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frpaz&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">&#39;Paris-Austerlitz&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;frpaz&#39;</span><span class="p">)</span>
<span class="go">683.526...</span>
</pre></div>
</div>
<p>From any point of reference:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo</span> <span class="o">=</span> <span class="n">GeoBase</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s">&#39;ori_por_multi&#39;</span><span class="p">)</span> <span class="c"># we have a few duplicates even with (iata, loc_type) key</span>
<span class="go">/!\ [lno ...] RDU+CA is duplicated #1, first found lno ...</span>
<span class="go">/!\ [lno ...] RDU+CA is duplicated #2, first found lno ...</span>
<span class="go">/!\ [lno ...] RDU+CA is duplicated #3, first found lno ...</span>
<span class="go">Import successful from ...</span>
<span class="go">Available fields for things: ...</span>
</pre></div>
</div>
<dl class="class">
<dt id="GeoBases.GeoBaseModule.GeoBase">
<em class="property">class </em><tt class="descclassname">GeoBases.GeoBaseModule.</tt><tt class="descname">GeoBase</tt><big>(</big><em>data</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<p>This is the main and only class. After __init__,
a file is loaded in memory, and the user may use
the instance to get information.</p>
<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.biasFuzzyCache">
<tt class="descname">biasFuzzyCache</tt><big>(</big><em>fuzzy_value</em>, <em>field</em>, <em>approximate</em>, <em>min_match</em>, <em>biased_result</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.biasFuzzyCache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.biasFuzzyCache" title="Permalink to this definition">¶</a></dt>
<dd><p>If algorithms for fuzzy searches are failing on a single example,
it is possible to use a first cache which will block
the research and force the result.</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.clearBiasCache">
<tt class="descname">clearBiasCache</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.clearBiasCache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.clearBiasCache" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear biasing cache for fuzzy searches.</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.clearCache">
<tt class="descname">clearCache</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.clearCache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.clearCache" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear cache for fuzzy searches.</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.createGrid">
<tt class="descname">createGrid</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.createGrid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.createGrid" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the grid for geographical indexation after loading the data.</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.delete">
<tt class="descname">delete</tt><big>(</big><em>key</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.delete"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to manually remove a value in the base.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> &#8211; the key we want to change a value of</li>
<li><strong>field</strong> &#8211; the concerned field, like &#8216;name&#8217;</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frxrn&#39;</span><span class="p">)</span> <span class="c"># Output all data in one dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;frxrn&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frxrn&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">KeyError: &#39;Thing not found</span>: <span class="n">frxrn&#39;</span>
</pre></div>
</div>
<p>How to reverse the delete if data has been stored:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">setWithDict</span><span class="p">(</span><span class="s">&#39;frxrn&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frxrn&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">&#39;Redon&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.distance">
<tt class="descname">distance</tt><big>(</big><em>key0</em>, <em>key1</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.distance"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.distance" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute distance between two elements.</p>
<p>This is just a wrapper between the original haversine
function, but it is probably the most used feature :)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key0</strong> &#8211; the first key</li>
<li><strong>key1</strong> &#8211; the second key</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the distance (km)</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;frpaz&#39;</span><span class="p">)</span>
<span class="go">683.526...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.findClosestFromPoint">
<tt class="descname">findClosestFromPoint</tt><big>(</big><em>lat_lng</em>, <em>N=1</em>, <em>from_keys=None</em>, <em>grid=True</em>, <em>double_check=True</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.findClosestFromPoint"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.findClosestFromPoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Concept close to findNearPoint, but here we do not
look for the things radius-close to a point,
we look for the closest thing from this point, given by
latitude/longitude.</p>
<p>Note that a similar implementation is done in
the LocalHelper, to find efficiently N closest point
in a graph, from a point (using heaps).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lat_lng</strong> &#8211; the lat_lng of the point</li>
<li><strong>N</strong> &#8211; the N closest results wanted</li>
<li><strong>from_keys</strong> &#8211; if None, it takes all keys in consideration, else takes from_keys             iterable of keys to perform findClosestFromPoint. This is useful when we have names             and have to perform a matching based on name and location (see fuzzyGetAroundLatLng).</li>
<li><strong>grid</strong> &#8211; boolean, use grid or not</li>
<li><strong>double_check</strong> &#8211; when using grid, perform an additional check on results distance</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">one key (like &#8216;SFO&#8217;), or a list if approximate is not None</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">)))</span> <span class="c"># Nice</span>
<span class="go">[(5.82..., &#39;NCE&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span> <span class="c"># Nice</span>
<span class="go">[(5.82..., &#39;NCE&#39;), (30.28..., &#39;CEQ&#39;), (79.71..., &#39;ALL&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="c"># Nice</span>
<span class="go">[(0.56..., &#39;frnic&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Corner case, from_keys empty is not used</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">from_keys</span><span class="o">=</span><span class="p">()))</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#from datetime import datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#before = datetime.now()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#for _ in range(100): s = geo_a.findClosestFromPoint((43.70, 7.26), N=3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#print(datetime.now() - before)</span>
</pre></div>
</div>
<p>No grid.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span> <span class="c"># Nice</span>
<span class="go">[(0.60..., &#39;NCE@1&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span> <span class="c"># Nice</span>
<span class="go">[(5.82..., &#39;NCE&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span> <span class="c"># Nice</span>
<span class="go">[(5.82..., &#39;NCE&#39;), (30.28..., &#39;CEQ&#39;), (79.71..., &#39;ALL&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span> <span class="c"># Nice</span>
<span class="go">[(0.56..., &#39;frnic&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">from_keys</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;frpaz&#39;</span><span class="p">,</span> <span class="s">&#39;frply&#39;</span><span class="p">,</span> <span class="s">&#39;frbve&#39;</span><span class="p">)))</span>
<span class="go">[(482.84..., &#39;frbve&#39;), (683.89..., &#39;frpaz&#39;)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.findNearKey">
<tt class="descname">findNearKey</tt><big>(</big><em>key</em>, <em>radius=50</em>, <em>from_keys=None</em>, <em>grid=True</em>, <em>double_check=True</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.findNearKey"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.findNearKey" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as findNearPoint, except the point is given
not by a lat/lng, but with its key, like ORY or SFO.
We just look up in the base to retrieve lat/lng, and
call findNearPoint.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> &#8211; the key of the point</li>
<li><strong>radius</strong> &#8211; the radius of the search (kilometers)</li>
<li><strong>from_keys</strong> &#8211; if None, it takes all keys in consideration, else takes from_keys             iterable of keys to perform search.</li>
<li><strong>grid</strong> &#8211; boolean, use grid or not</li>
<li><strong>double_check</strong> &#8211; when using grid, perform an additional check on results distance</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a list of keys of things (like [&#8216;ORY&#8217;, &#8216;CDG&#8217;])</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="c"># Orly, por &lt;= 10km</span>
<span class="go">[(0.0, &#39;ORY&#39;), (1.82..., &#39;JDP&#39;), (8.06..., &#39;XJY&#39;), (9.95..., &#39;QFC&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span> <span class="c"># Orly, airports &lt;= 50km</span>
<span class="go">[(0.0, &#39;ORY&#39;), (18.8..., &#39;TNF&#39;), (27.8..., &#39;LBG&#39;), (34.8..., &#39;CDG&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="c"># Nice station, stations &lt;= 5km</span>
<span class="go">[(0.0, &#39;frnic&#39;), (2.2..., &#39;fr4342&#39;), (2.3..., &#39;fr5737&#39;), (4.1..., &#39;fr4708&#39;), (4.5..., &#39;fr6017&#39;)]</span>
</pre></div>
</div>
<p>No grid.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Orly, airports &lt;= 50km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
<span class="go">[(0.0, &#39;ORY&#39;), (18.8..., &#39;TNF&#39;), (27.8..., &#39;LBG&#39;), (34.8..., &#39;CDG&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Nice station, stations &lt;= 5km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
<span class="go">[(0.0, &#39;frnic&#39;), (2.2..., &#39;fr4342&#39;), (2.3..., &#39;fr5737&#39;), (4.1..., &#39;fr4708&#39;), (4.5..., &#39;fr6017&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">from_keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="s">&#39;CDG&#39;</span><span class="p">,</span> <span class="s">&#39;SFO&#39;</span><span class="p">]))</span>
<span class="go">[(0.0, &#39;ORY&#39;), (34.8..., &#39;CDG&#39;)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.findNearPoint">
<tt class="descname">findNearPoint</tt><big>(</big><em>lat_lng</em>, <em>radius=50</em>, <em>from_keys=None</em>, <em>grid=True</em>, <em>double_check=True</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.findNearPoint"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.findNearPoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of nearby things from a point (given
latidude and longitude), and a radius for the search.
Note that the haversine function, which compute distance
at the surface of a sphere, here returns kilometers,
so the radius should be in kms.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lat_lng</strong> &#8211; the lat_lng of the point</li>
<li><strong>radius</strong> &#8211; the radius of the search (kilometers)</li>
<li><strong>from_keys</strong> &#8211; if None, it takes all keys in consideration, else takes from_keys             iterable of keys to perform search.</li>
<li><strong>grid</strong> &#8211; boolean, use grid or not</li>
<li><strong>double_check</strong> &#8211; when using grid, perform an additional check on results distance</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">an iterable of keys of things (like [&#8216;ORY&#8217;, &#8216;CDG&#8217;])</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Paris, airports &lt;= 50km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">geo_a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findNearPoint</span><span class="p">((</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">),</span> <span class="mi">50</span><span class="p">))]</span>
<span class="go">[&#39;Paris-Orly&#39;, &#39;Paris-Le Bourget&#39;, &#39;Toussus-le-Noble&#39;, &#39;Paris - Charles-de-Gaulle&#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Nice, stations &lt;= 5km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findNearPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="mi">5</span><span class="p">))]</span>
<span class="go">[&#39;Nice-Ville&#39;, &#39;Nice-Riquier&#39;, &#39;Nice-St-Roch&#39;, &#39;Villefranche-sur-Mer&#39;, &#39;Nice-St-Augustin&#39;]</span>
</pre></div>
</div>
<p>No grid mode.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Paris, airports &lt;= 50km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">geo_a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findNearPoint</span><span class="p">((</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">),</span> <span class="mi">50</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))]</span>
<span class="go">[&#39;Paris-Orly&#39;, &#39;Paris-Le Bourget&#39;, &#39;Toussus-le-Noble&#39;, &#39;Paris - Charles-de-Gaulle&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Nice, stations &lt;= 5km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">geo_t</span><span class="o">.</span><span class="n">findNearPoint</span><span class="p">((</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))]</span>
<span class="go">[&#39;Nice-Ville&#39;, &#39;Nice-Riquier&#39;, &#39;Nice-St-Roch&#39;, &#39;Villefranche-sur-Mer&#39;, &#39;Nice-St-Augustin&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Paris, airports &lt;= 50km with from_keys input list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">findNearPoint</span><span class="p">((</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">),</span> <span class="mi">50</span><span class="p">,</span> <span class="n">from_keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="s">&#39;CDG&#39;</span><span class="p">,</span> <span class="s">&#39;BVE&#39;</span><span class="p">],</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
<span class="go">[(12.76..., &#39;ORY&#39;), (23.40..., &#39;CDG&#39;)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.fuzzyGet">
<tt class="descname">fuzzyGet</tt><big>(</big><em>fuzzy_value</em>, <em>field</em>, <em>approximate=None</em>, <em>min_match=0.75</em>, <em>from_keys=None</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.fuzzyGet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.fuzzyGet" title="Permalink to this definition">¶</a></dt>
<dd><p>We get to the cool stuff.</p>
<p>Fuzzy searches are retrieving an information
on a thing when we do not know the code.
We compare the value fuzzy_value which is supposed to be a field
(e.g. a city or a name), to all things we have in the base,
and we output the best match.
Matching is performed using Levenshtein module, with a modified
version of the Lenvenshtein ratio, adapted to the type of data.</p>
<p>Example: we look up &#8216;Marseille Saint Ch.&#8217; in our base
and we find the corresponding code by comparing all station
names with &#8216;&#8217;Marseille Saint Ch.&#8217;&#8216;.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fuzzy_value</strong> &#8211; the value, like &#8216;Marseille&#8217;</li>
<li><strong>field</strong> &#8211; the field we look into, like &#8216;name&#8217;</li>
<li><strong>approximate</strong> &#8211; max number of results, None means all results</li>
<li><strong>min_match</strong> &#8211; filter out matches under this threshold</li>
<li><strong>from_keys</strong> &#8211; if None, it takes all keys in consideration, else takes from_keys             iterable of keys to perform fuzzyGet. This is useful when we have geocodes             and have to perform a matching based on name and location (see fuzzyGetAroundLatLng).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a couple with the best match and the distance found</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;Marseille Charles&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0.8..., &#39;frmsc&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0.78..., &#39;CDG&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.55</span><span class="p">)</span>
<span class="go">[(0.78..., &#39;CDG&#39;), (0.60..., &#39;HUX&#39;), (0.57..., &#39;LBG&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="go">[(0.78..., &#39;CDG&#39;)]</span>
</pre></div>
</div>
<p>Some corner cases.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="bp">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0.78..., &#39;CDG&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">from_keys</span><span class="o">=</span><span class="p">[])</span>
<span class="go">[]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.fuzzyGetAroundLatLng">
<tt class="descname">fuzzyGetAroundLatLng</tt><big>(</big><em>lat_lng</em>, <em>radius</em>, <em>fuzzy_value</em>, <em>field</em>, <em>approximate=None</em>, <em>min_match=0.75</em>, <em>from_keys=None</em>, <em>grid=True</em>, <em>double_check=True</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.fuzzyGetAroundLatLng"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.fuzzyGetAroundLatLng" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as fuzzyGet but with we search only within a radius
from a geocode.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>lat_lng</strong> &#8211; the lat_lng of the point</li>
<li><strong>radius</strong> &#8211; the radius of the search (kilometers)</li>
<li><strong>fuzzy_value</strong> &#8211; the value, like &#8216;Marseille&#8217;</li>
<li><strong>field</strong> &#8211; the field we look into, like &#8216;name&#8217;</li>
<li><strong>approximate</strong> &#8211; if None, returns the best, if an int, returns a list of             n best matches</li>
<li><strong>from_keys</strong> &#8211; if None, it takes all keys in consideration, else takes from_keys             iterable of keys to perform search.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGet</span><span class="p">(</span><span class="s">&#39;Brussels&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.60</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0.61..., &#39;BQT&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;BQT&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>  <span class="c"># Brussels just matched on Brest!!</span>
<span class="go">&#39;Brest&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;BRU&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="c"># We wanted BRU for &#39;Bruxelles&#39;</span>
<span class="go">&#39;Bruxelles National&#39;</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Now a request limited to a circle of 20km around BRU gives BRU</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGetAroundLatLng</span><span class="p">((</span><span class="mf">50.9013890</span><span class="p">,</span> <span class="mf">4.4844440</span><span class="p">),</span> <span class="mi">20</span><span class="p">,</span> <span class="s">&#39;Brussels&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.40</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0.46..., &#39;BRU&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Now a request limited to some input keys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGetAroundLatLng</span><span class="p">((</span><span class="mf">50.9013890</span><span class="p">,</span> <span class="mf">4.4844440</span><span class="p">),</span> <span class="mi">2000</span><span class="p">,</span> <span class="s">&#39;Brussels&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.30</span><span class="p">,</span> <span class="n">from_keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;CDG&#39;</span><span class="p">,</span> <span class="s">&#39;ORY&#39;</span><span class="p">])</span>
<span class="go">[(0.33..., &#39;ORY&#39;)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.fuzzyGetCached">
<tt class="descname">fuzzyGetCached</tt><big>(</big><em>fuzzy_value</em>, <em>field</em>, <em>approximate=None</em>, <em>min_match=0.75</em>, <em>verbose=True</em>, <em>show_bad=(1</em>, <em>1)</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.fuzzyGetCached"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.fuzzyGetCached" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as fuzzyGet but with a caching and bias system.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fuzzy_value</strong> &#8211; the value, like &#8216;Marseille&#8217;</li>
<li><strong>field</strong> &#8211; the field we look into, like &#8216;name&#8217;</li>
<li><strong>approximate</strong> &#8211; if None, returns the best, if an int, returns a list of             n best matches</li>
<li><strong>verbose</strong> &#8211; display a certain range of similarity</li>
<li><strong>show_bad</strong> &#8211; the range of similarity</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the best match</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">fuzzyGetCached</span><span class="p">(</span><span class="s">&#39;Marseille Saint Ch.&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(0.8..., &#39;frmsc&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGetCached</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">show_bad</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">[0.79]           paris+de+gaulle -&gt;   paris+charles+de+gaulle (  CDG)</span>
<span class="go">(0.78..., &#39;CDG&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGetCached</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.60</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">show_bad</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="go">[0.79]           paris+de+gaulle -&gt;   paris+charles+de+gaulle (  CDG)</span>
<span class="go">[0.61]           paris+de+gaulle -&gt;        bahias+de+huatulco (  HUX)</span>
<span class="go">[(0.78..., &#39;CDG&#39;), (0.60..., &#39;HUX&#39;)]</span>
</pre></div>
</div>
<p>Some biasing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">biasFuzzyCache</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="p">[(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s">&#39;Biased result&#39;</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGetCached</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">show_bad</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># Cache there</span>
<span class="go">(0.78..., &#39;CDG&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">fuzzyGetCached</span><span class="p">(</span><span class="s">&#39;paris de gaulle&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">min_match</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="go">Using bias: (&#39;paris+de+gaulle&#39;, &#39;name&#39;, None, 0.75)</span>
<span class="go">[(0.5, &#39;Biased result&#39;)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.get">
<tt class="descname">get</tt><big>(</big><em>key</em>, <em>field=None</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.get"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple get on the base.</p>
<p>This get function raises an exception when input is not correct.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> &#8211; the key of the thing (like &#8216;SFO&#8217;)</li>
<li><strong>field</strong> &#8211; the field (like &#8216;name&#8217; or &#8216;iata_code&#8217;)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises :</th><td class="field-body"><p class="first">KeyError, if the key is not in the base</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the needed information</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CDG&#39;</span><span class="p">,</span> <span class="s">&#39;city_code&#39;</span><span class="p">)</span>
<span class="go">&#39;PAR&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">&#39;Nice-Ville&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">)</span>
<span class="go">{&#39;info&#39;: &#39;Desserte Voyageur-Infrastructure&#39;, &#39;code&#39;: &#39;frnic&#39;, ...}</span>
</pre></div>
</div>
<p>Cases of unknown key.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frmoron&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;There&#39;</span><span class="p">)</span>
<span class="go">&#39;There&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frmoron&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">KeyError: &#39;Thing not found</span>: <span class="n">frmoron&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frmoron&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frmoron&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;There&#39;</span><span class="p">)</span>
<span class="go">&#39;There&#39;</span>
</pre></div>
</div>
<p>Cases of unknown field, this is a bug and always fail.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;not_a_field&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;There&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">KeyError</span>: <span class="n">&quot;Field &#39;not_a_field&#39; [for key &#39;frnic&#39;] not in [&#39;info&#39;, &#39;code&#39;, &#39;name&#39;, &#39;lines@raw&#39;, &#39;lines&#39;, &#39;__gar__&#39;, &#39;__par__&#39;, &#39;__dup__&#39;, &#39;__key__&#39;, &#39;lat&#39;, &#39;lng&#39;, &#39;__lno__&#39;]&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.getAllDuplicates">
<tt class="descname">getAllDuplicates</tt><big>(</big><em>key</em>, <em>field=None</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.getAllDuplicates"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.getAllDuplicates" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all duplicates data, parent key included.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">getAllDuplicates</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">[&#39;Paris-Orly&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">getAllDuplicates</span><span class="p">(</span><span class="s">&#39;THA&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">[&#39;Tullahoma Regional Airport/William Northern Field&#39;, &#39;Tullahoma&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">getAllDuplicates</span><span class="p">(</span><span class="s">&#39;THA&#39;</span><span class="p">,</span> <span class="s">&#39;__key__&#39;</span><span class="p">)</span>
<span class="go">[&#39;THA&#39;, &#39;THA@1&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">getAllDuplicates</span><span class="p">(</span><span class="s">&#39;THA@1&#39;</span><span class="p">,</span> <span class="s">&#39;__key__&#39;</span><span class="p">)</span>
<span class="go">[&#39;THA@1&#39;, &#39;THA&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;THA&#39;</span><span class="p">,</span> <span class="s">&#39;__dup__&#39;</span><span class="p">)</span>
<span class="go">[&#39;THA@1&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.getKeysWhere">
<tt class="descname">getKeysWhere</tt><big>(</big><em>conditions</em>, <em>from_keys=None</em>, <em>reverse=False</em>, <em>force_str=False</em>, <em>mode='and'</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.getKeysWhere"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.getKeysWhere" title="Permalink to this definition">¶</a></dt>
<dd><p>Get iterator of all keys with particular field.</p>
<p>For example, if you want to know all airports in Paris.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>conditions</strong> &#8211; a list of (field, value) conditions</li>
<li><strong>reverse</strong> &#8211; we look keys where the field is <em>not</em> the particular value</li>
<li><strong>force_str</strong> &#8211; for the str() method before every test</li>
<li><strong>mode</strong> &#8211; either &#8216;or&#8217; or &#8216;and&#8217;, how to handle several conditions</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">an iterator of matching keys</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_a</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;city_code&#39;</span><span class="p">,</span> <span class="s">&#39;PAR&#39;</span><span class="p">)]))</span>
<span class="go">[&#39;ORY&#39;, &#39;TNF&#39;, &#39;CDG&#39;, &#39;BVA&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;comment&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;__dup__&#39;</span><span class="p">,</span> <span class="s">&#39;[]&#39;</span><span class="p">)]))</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;__dup__&#39;</span><span class="p">,</span> <span class="p">[])])))</span>
<span class="go">7025</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;__dup__&#39;</span><span class="p">,</span> <span class="s">&#39;[]&#39;</span><span class="p">)],</span> <span class="n">force_str</span><span class="o">=</span><span class="bp">True</span><span class="p">)))</span>
<span class="go">7025</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;__par__&#39;</span><span class="p">,</span> <span class="p">[])],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)))</span> <span class="c"># Counting duplicated keys</span>
<span class="go">4431</span>
</pre></div>
</div>
<p>Testing several conditions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c_1</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;city_code&#39;</span>    <span class="p">,</span> <span class="s">&#39;PAR&#39;</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c_2</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;location_type&#39;</span><span class="p">,</span> <span class="s">&#39;H&#39;</span>  <span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">(</span><span class="n">c_1</span><span class="p">)))</span>
<span class="go">18</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">(</span><span class="n">c_2</span><span class="p">)))</span>
<span class="go">91</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">(</span><span class="n">c_1</span> <span class="o">+</span> <span class="n">c_2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;and&#39;</span><span class="p">)))</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">(</span><span class="n">c_1</span> <span class="o">+</span> <span class="n">c_2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;or&#39;</span><span class="p">)))</span>
<span class="go">107</span>
</pre></div>
</div>
<p>This works too o/.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;city_code&#39;</span><span class="p">,</span> <span class="s">&#39;PAR&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;city_code&#39;</span><span class="p">,</span> <span class="s">&#39;BVE&#39;</span><span class="p">)],</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;and&#39;</span><span class="p">)))</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">geo_o</span><span class="o">.</span><span class="n">getKeysWhere</span><span class="p">([(</span><span class="s">&#39;city_code&#39;</span><span class="p">,</span> <span class="s">&#39;PAR&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;city_code&#39;</span><span class="p">,</span> <span class="s">&#39;BVE&#39;</span><span class="p">)],</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;or&#39;</span><span class="p">)))</span>
<span class="go">20</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.getLocation">
<tt class="descname">getLocation</tt><big>(</big><em>key</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.getLocation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.getLocation" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns geocode as (float, float) or None.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">getLocation</span><span class="p">(</span><span class="s">&#39;AGN&#39;</span><span class="p">)</span>
<span class="go">(57.50..., -134.585...)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.hasDuplicates">
<tt class="descname">hasDuplicates</tt><big>(</big><em>key</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.hasDuplicates"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.hasDuplicates" title="Permalink to this definition">¶</a></dt>
<dd><p>Tell if a key has duplicates.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">hasDuplicates</span><span class="p">(</span><span class="s">&#39;MRS&#39;</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">hasDuplicates</span><span class="p">(</span><span class="s">&#39;MRS@1&#39;</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">hasDuplicates</span><span class="p">(</span><span class="s">&#39;PAR&#39;</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.hasGeoSupport">
<tt class="descname">hasGeoSupport</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.hasGeoSupport"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.hasGeoSupport" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if data type has geocoding support.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">hasGeoSupport</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_f</span><span class="o">.</span><span class="n">hasGeoSupport</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.hasParents">
<tt class="descname">hasParents</tt><big>(</big><em>key</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.hasParents"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.hasParents" title="Permalink to this definition">¶</a></dt>
<dd><p>Tell if a key has parents.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">hasParents</span><span class="p">(</span><span class="s">&#39;MRS&#39;</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">hasParents</span><span class="p">(</span><span class="s">&#39;MRS@1&#39;</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_o</span><span class="o">.</span><span class="n">hasParents</span><span class="p">(</span><span class="s">&#39;PAR&#39;</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="GeoBases.GeoBaseModule.GeoBase.hasTrepSupport">
<em class="property">static </em><tt class="descname">hasTrepSupport</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.hasTrepSupport"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.hasTrepSupport" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if module has OpenTrep support.</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.keys">
<tt class="descname">keys</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.keys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of all keys in the base.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the list of all keys</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_a</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;AGN&#39;, &#39;AGM&#39;, &#39;AGJ&#39;, &#39;AGH&#39;, ...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.set">
<tt class="descname">set</tt><big>(</big><em>key</em>, <em>field</em>, <em>value</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.set"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.set" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to manually change a value in the base.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> &#8211; the key we want to change a value of</li>
<li><strong>field</strong> &#8211; the concerned field, like &#8216;name&#8217;</li>
<li><strong>value</strong> &#8211; the new value</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">&#39;Nice-Ville&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;Nice Gare SNCF&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">&#39;Nice Gare SNCF&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;Nice-Ville&#39;</span><span class="p">)</span> <span class="c"># Not to mess with other tests :)</span>
</pre></div>
</div>
<p>We may even add new fields.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;new_field&#39;</span><span class="p">,</span> <span class="s">&#39;some_value&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;new_field&#39;</span><span class="p">)</span>
<span class="go">&#39;some_value&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.setWithDict">
<tt class="descname">setWithDict</tt><big>(</big><em>key</em>, <em>dictionary</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.setWithDict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.setWithDict" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as set method, except we perform
the input with a whole dictionary.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> &#8211; the key we want to change a value of</li>
<li><strong>dictionary</strong> &#8211; the dict containing the new data</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">geo_f</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_f</span><span class="o">.</span><span class="n">setWithDict</span><span class="p">(</span><span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;code&#39;</span> <span class="p">:</span> <span class="s">&#39;frnic&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Nice&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geo_f</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;frnic&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="GeoBases.GeoBaseModule.GeoBase.trepGet">
<em class="property">static </em><tt class="descname">trepGet</tt><big>(</big><em>fuzzy_value</em>, <em>trep_format='S'</em>, <em>from_keys=None</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.trepGet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.trepGet" title="Permalink to this definition">¶</a></dt>
<dd><p>OpenTrep integration.</p>
<p>If not hasTrepSupport(), main_trep is not defined
and trepGet will raise an exception if called.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">geo_t</span><span class="o">.</span><span class="n">hasTrepSupport</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">geo_t</span><span class="o">.</span><span class="n">trepGet</span><span class="p">(</span><span class="s">&#39;sna francisco los agneles&#39;</span><span class="p">)</span> 
<span class="go">[(31.5192, &#39;SFO&#39;), (46.284, &#39;LAX&#39;)]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">geo_t</span><span class="o">.</span><span class="n">hasTrepSupport</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">geo_t</span><span class="o">.</span><span class="n">trepGet</span><span class="p">(</span><span class="s">&#39;sna francisco&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> 
<span class="go"> -&gt; Raw result: SFO/31.5192</span>
<span class="go"> -&gt; Fmt result: ([(31.5192, &#39;SFO&#39;)], &#39;&#39;)</span>
<span class="go">[(31.5192, &#39;SFO&#39;)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="staticmethod">
<dt id="GeoBases.GeoBaseModule.GeoBase.update">
<em class="property">static </em><tt class="descname">update</tt><big>(</big><em>force=False</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.update"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Launch update script on data files.</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoBaseModule.GeoBase.visualize">
<tt class="descname">visualize</tt><big>(</big><em>output='example'</em>, <em>label='__key__'</em>, <em>point_size=None</em>, <em>point_color=None</em>, <em>icon_type='auto'</em>, <em>from_keys=None</em>, <em>catalog=None</em>, <em>add_lines=None</em>, <em>link_duplicates=True</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoBaseModule.html#GeoBase.visualize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoBaseModule.GeoBase.visualize" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates map and other visualizations.</p>
<p>Returns list of templates successfully rendered.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-GeoBases.GeoGridModule">
<span id="geogridmodule-module"></span><h2><tt class="xref py py-mod docutils literal"><span class="pre">GeoGridModule</span></tt> Module<a class="headerlink" href="#module-GeoBases.GeoGridModule" title="Permalink to this headline">¶</a></h2>
<p>This module is grid implementation, in order
to provide geographical indexation features.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">GeoGrid</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="go">Setting grid precision to 4, avg radius to 20km</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">48.72</span><span class="p">,</span> <span class="mf">2.359</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;CDG&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">48.75</span><span class="p">,</span> <span class="mf">2.361</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">_findInAdjacentCases</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="mf">48.72</span><span class="p">,</span> <span class="mf">2.359</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">_precision</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="go">[&#39;ORY&#39;, &#39;CDG&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">_keys</span><span class="p">[</span><span class="s">&#39;ORY&#39;</span><span class="p">]</span>
<span class="go">{&#39;case&#39;: &#39;u09t&#39;, &#39;lat_lng&#39;: (48.7..., 2.359)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neighbors</span><span class="p">(</span><span class="s">&#39;t0db&#39;</span><span class="p">)</span>
<span class="go">[&#39;t0d8&#39;, &#39;t0e0&#39;, &#39;t06z&#39;, &#39;t06x&#39;, &#39;t07p&#39;, &#39;t0dc&#39;, &#39;t0d9&#39;, &#39;t0e1&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">_recursiveFrontier</span><span class="p">(</span><span class="s">&#39;t0dbr&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="go">[set([&#39;t0dbr&#39;]), set([&#39;t0e08&#39;, &#39;t0e00&#39;, &#39;t0dbn&#39;, &#39;t0e02&#39;, &#39;t0dbq&#39;, &#39;t0dbp&#39;, &#39;t0dbw&#39;, &#39;t0dbx&#39;])]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">_recursiveFrontier</span><span class="p">(</span><span class="s">&#39;t0dbr&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="go">[set([&#39;t0dbr&#39;])]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">_recursiveFrontier</span><span class="p">(</span><span class="s">&#39;t0dbr&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="go">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">_recursiveFrontier</span><span class="p">(</span><span class="s">&#39;t0dbr&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="go">25</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">_recursiveFrontier</span><span class="p">(</span><span class="s">&#39;t0dbr&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
<span class="go">49</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">_recursiveFrontier</span><span class="p">(</span><span class="s">&#39;t0dbr&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
<span class="go">81</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="go">[(0, &#39;ORY&#39;), (0, &#39;CDG&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">findNearKey</span><span class="p">(</span><span class="s">&#39;ORY&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">double_check</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="go">[(0.0, &#39;ORY&#39;), (3.33..., &#39;CDG&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">findClosestFromPoint</span><span class="p">((</span><span class="mf">48.75</span><span class="p">,</span> <span class="mf">2.361</span><span class="p">),</span> <span class="n">N</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">double_check</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="go">[(0.0, &#39;CDG&#39;), (3.33..., &#39;ORY&#39;)]</span>
</pre></div>
</div>
<dl class="class">
<dt id="GeoBases.GeoGridModule.GeoGrid">
<em class="property">class </em><tt class="descclassname">GeoBases.GeoGridModule.</tt><tt class="descname">GeoGrid</tt><big>(</big><em>precision=5</em>, <em>radius=None</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoGridModule.html#GeoGrid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoGridModule.GeoGrid" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></p>
<p>This is the main and only class.</p>
<dl class="method">
<dt id="GeoBases.GeoGridModule.GeoGrid.add">
<tt class="descname">add</tt><big>(</big><em>key</em>, <em>lat_lng</em>, <em>verbose=True</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoGridModule.html#GeoGrid.add"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoGridModule.GeoGrid.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a point to the grid.</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoGridModule.GeoGrid.findClosestFromPoint">
<tt class="descname">findClosestFromPoint</tt><big>(</big><em>lat_lng</em>, <em>N=1</em>, <em>double_check=False</em>, <em>from_keys=None</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoGridModule.html#GeoGrid.findClosestFromPoint"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoGridModule.GeoGrid.findClosestFromPoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Find closest keys from a (lat, lng).
Returns a iterator of (dist, key).</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoGridModule.GeoGrid.findNearKey">
<tt class="descname">findNearKey</tt><big>(</big><em>key</em>, <em>radius=20</em>, <em>double_check=False</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoGridModule.html#GeoGrid.findNearKey"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoGridModule.GeoGrid.findNearKey" title="Permalink to this definition">¶</a></dt>
<dd><p>Find keys near an input key.
Returns an iterator of (dist, key).</p>
</dd></dl>

<dl class="method">
<dt id="GeoBases.GeoGridModule.GeoGrid.findNearPoint">
<tt class="descname">findNearPoint</tt><big>(</big><em>lat_lng</em>, <em>radius=20</em>, <em>double_check=False</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoGridModule.html#GeoGrid.findNearPoint"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoGridModule.GeoGrid.findNearPoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Find keys near a (lat, lng).
Returns an iterator of (dist, key).</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-GeoBases.GeoUtils">
<span id="geoutils-module"></span><h2><tt class="xref py py-mod docutils literal"><span class="pre">GeoUtils</span></tt> Module<a class="headerlink" href="#module-GeoBases.GeoUtils" title="Permalink to this headline">¶</a></h2>
<p>This module is composed of several functions useful
for performing calculations on a sphere, such as distance or projections.
A part of them has been adapted from:
<a class="reference external" href="http://www.movable-type.co.uk/scripts/latlong.html">http://www.movable-type.co.uk/scripts/latlong.html</a></p>
<p>Functions frequently used by other modules:</p>
<blockquote>
<div><ul class="simple">
<li>haversine: a function to compute the shortest path distance
between two points on a sphere</li>
<li>prog_point: a function to compute the localization of a point
traveling on the shortest path between two points on a sphere,
given a progression ratio (like 0%, 50% or 100%). This one uses
a dichotomy, because so far I have an exact formula only for 50%
(implemented in function mid_point)</li>
</ul>
</div></blockquote>
<p>Simple examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">haversine</span><span class="p">((</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">),</span> <span class="p">(</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">))</span> <span class="c"># Paris -&gt; Nice</span>
<span class="go">683.85...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prog_point</span><span class="p">(</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">,</span> <span class="mf">35.5522</span><span class="p">,</span> <span class="mf">139.7796</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
<span class="go">(48.91..., 2.43...)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prog_point</span><span class="p">(</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">,</span> <span class="mf">35.5522</span><span class="p">,</span> <span class="mf">139.7796</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="go">(35.552..., 139.779...)</span>
</pre></div>
</div>
<dl class="function">
<dt id="GeoBases.GeoUtils.haversine">
<tt class="descclassname">GeoBases.GeoUtils.</tt><tt class="descname">haversine</tt><big>(</big><em>L0</em>, <em>L1</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoUtils.html#haversine"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoUtils.haversine" title="Permalink to this definition">¶</a></dt>
<dd><p>As a matter of fact, it is easier for other
libraries to just use two parameters.
Exposing this function is more compliant with
geohash signatures and getLocations() geobase function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>L0</strong> &#8211; the LatLng tuple of the first point</li>
<li><strong>L1</strong> &#8211; the LatLng tuple of the second point</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the distance in kilometers</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">haversine</span><span class="p">((</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">),</span> <span class="p">(</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">))</span> <span class="c"># Paris -&gt; Nice</span>
<span class="go">683.85...</span>
</pre></div>
</div>
<p>Case of unknown location.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">haversine</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">(</span><span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">))</span> <span class="c"># returns None</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.GeoUtils.haversine_precise">
<tt class="descclassname">GeoBases.GeoUtils.</tt><tt class="descname">haversine_precise</tt><big>(</big><em>lat0</em>, <em>lng0</em>, <em>lat1</em>, <em>lng1</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoUtils.html#haversine_precise"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoUtils.haversine_precise" title="Permalink to this definition">¶</a></dt>
<dd><p>A function to compute the shortest path distance
between two points on a sphere, using Haversine formula.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lat0</strong> &#8211; the latitude of the first point</li>
<li><strong>lng0</strong> &#8211; the longitude of the first point</li>
<li><strong>lat1</strong> &#8211; the latitude of the second point</li>
<li><strong>lng1</strong> &#8211; the longitude of the second point</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the distance in kilometers</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">haversine_precise</span><span class="p">(</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">,</span> <span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">)</span> <span class="c"># Paris -&gt; Nice</span>
<span class="go">683.85...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">haversine_precise</span><span class="p">(</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">,</span> <span class="mf">35.5522</span><span class="p">,</span> <span class="mf">139.7796</span><span class="p">)</span> <span class="c"># Paris -&gt; Tokyo</span>
<span class="go">9730.22...</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.GeoUtils.haversine_simple">
<tt class="descclassname">GeoBases.GeoUtils.</tt><tt class="descname">haversine_simple</tt><big>(</big><em>lat0</em>, <em>lng0</em>, <em>lat1</em>, <em>lng1</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoUtils.html#haversine_simple"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoUtils.haversine_simple" title="Permalink to this definition">¶</a></dt>
<dd><p>Another implementation of Haversine formula,
but this one works well only for small amplitudes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lat0</strong> &#8211; the latitude of the first point</li>
<li><strong>lng0</strong> &#8211; the longitude of the first point</li>
<li><strong>lat1</strong> &#8211; the latitude of the second point</li>
<li><strong>lng1</strong> &#8211; the longitude of the second point</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the distance in kilometers</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">haversine_simple</span><span class="p">(</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">,</span> <span class="mf">43.70</span><span class="p">,</span> <span class="mf">7.26</span><span class="p">)</span> <span class="c"># Paris -&gt; Nice</span>
<span class="go">683.85...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">haversine_simple</span><span class="p">(</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">,</span> <span class="mf">35.5522</span><span class="p">,</span> <span class="mf">139.7796</span><span class="p">)</span> <span class="c"># Paris -&gt; Tokyo</span>
<span class="go">9730.22...</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.GeoUtils.mercator">
<tt class="descclassname">GeoBases.GeoUtils.</tt><tt class="descname">mercator</tt><big>(</big><em>lat</em>, <em>lng</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoUtils.html#mercator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoUtils.mercator" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns Mercator projection</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lat</strong> &#8211; the latitude of the point</li>
<li><strong>lng</strong> &#8211; the longitude of the point</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the projection</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mercator</span><span class="p">(</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">)</span>
<span class="go">(0.85..., 0.04...)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.GeoUtils.mid_point">
<tt class="descclassname">GeoBases.GeoUtils.</tt><tt class="descname">mid_point</tt><big>(</big><em>lat0</em>, <em>lng0</em>, <em>lat1</em>, <em>lng1</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoUtils.html#mid_point"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoUtils.mid_point" title="Permalink to this definition">¶</a></dt>
<dd><p>A function to compute the localization exactly in the middle of
the shortest path between two points on a sphere.</p>
<p>The given example provides the point between Paris and Tokyo.
You can see the result at:
<a class="reference external" href="http://maps.google.com/maps?f=q&amp;hl=fr&amp;ie=UTF8&amp;ll=67.461,86.233&amp;t=k&amp;z=13">http://maps.google.com/maps?f=q&amp;hl=fr&amp;ie=UTF8&amp;ll=67.461,86.233&amp;t=k&amp;z=13</a>
It it somewhere in the North os Russia.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lat0</strong> &#8211; the latitude of the first point</li>
<li><strong>lng0</strong> &#8211; the longitude of the first point</li>
<li><strong>lat1</strong> &#8211; the latitude of the second point</li>
<li><strong>lng1</strong> &#8211; the longitude of the second point</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the position of the point in the middle</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mid_point</span><span class="p">(</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">,</span> <span class="mf">35.5522</span><span class="p">,</span> <span class="mf">139.7796</span><span class="p">)</span> <span class="c"># Paris -&gt; Tokyo</span>
<span class="go">(67.461..., 86.233...)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.GeoUtils.prog_point">
<tt class="descclassname">GeoBases.GeoUtils.</tt><tt class="descname">prog_point</tt><big>(</big><em>lat0</em>, <em>lng0</em>, <em>lat1</em>, <em>lng1</em>, <em>progression=0.5</em>, <em>accuracy=0.005</em>, <em>verbose=False</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoUtils.html#prog_point"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoUtils.prog_point" title="Permalink to this definition">¶</a></dt>
<dd><p>A function to compute the localization of a point
traveling on the shortest path between two points on a sphere,
given a progression ratio (like 0%, 50% or 100%).
This one uses a dichotomy on mid_point.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lat0</strong> &#8211; the latitude of the first point</li>
<li><strong>lng0</strong> &#8211; the longitude of the first point</li>
<li><strong>lat1</strong> &#8211; the latitude of the second point</li>
<li><strong>lng1</strong> &#8211; the longitude of the second point</li>
<li><strong>progression</strong> &#8211; the progression of the traveler of the shortest path</li>
<li><strong>accuracy</strong> &#8211; the accuracy of the dichotomy</li>
<li><strong>verbose</strong> &#8211; display or not informations about the dichotomy</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises :</th><td class="field-body"><p class="first">ValueError, if progression not in [0, 1]</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the position of the progressing point</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">prog_point</span><span class="p">(</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">,</span> <span class="mf">35.5522</span><span class="p">,</span> <span class="mf">139.7796</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">(48.84..., 2.367...)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prog_point</span><span class="p">(</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">,</span> <span class="mf">35.5522</span><span class="p">,</span> <span class="mf">139.7796</span><span class="p">,</span>
<span class="gp">... </span>           <span class="n">progression</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
<span class="gp">... </span>           <span class="n">accuracy</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
<span class="gp">... </span>           <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">0.0000 &lt; 0.0010 &lt; 0.0020 in 10 steps</span>
<span class="go">(48.91..., 2.43...)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prog_point</span><span class="p">(</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">,</span> <span class="mf">35.5522</span><span class="p">,</span> <span class="mf">139.7796</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="go">(67.461..., 86.233...)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prog_point</span><span class="p">(</span><span class="mf">48.84</span><span class="p">,</span> <span class="mf">2.367</span><span class="p">,</span> <span class="mf">35.5522</span><span class="p">,</span> <span class="mf">139.7796</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="go">(35.552..., 139.779...)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.GeoUtils.radian">
<tt class="descclassname">GeoBases.GeoUtils.</tt><tt class="descname">radian</tt><big>(</big><em>a</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoUtils.html#radian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoUtils.radian" title="Permalink to this definition">¶</a></dt>
<dd><p>Degree to radian conversion.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>a</strong> &#8211; the input in degree</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the output in radian</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">radian</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">radian</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
<span class="go">3.14...</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.GeoUtils.unradian">
<tt class="descclassname">GeoBases.GeoUtils.</tt><tt class="descname">unradian</tt><big>(</big><em>a</em><big>)</big><a class="reference internal" href="_modules/GeoBases/GeoUtils.html#unradian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.GeoUtils.unradian" title="Permalink to this definition">¶</a></dt>
<dd><p>Radian to degree conversion.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>a</strong> &#8211; the input in radian</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the output in degree</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">unradian</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unradian</span><span class="p">(</span><span class="mf">3.1415</span><span class="p">)</span>
<span class="go">179.9...</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-GeoBases.LevenshteinUtils">
<span id="levenshteinutils-module"></span><h2><tt class="xref py py-mod docutils literal"><span class="pre">LevenshteinUtils</span></tt> Module<a class="headerlink" href="#module-GeoBases.LevenshteinUtils" title="Permalink to this headline">¶</a></h2>
<p>This module is composed of several functions useful
for performing string comparisons. It is oriented for data like names of
cities, airports, train stations, because the string comparisons
will not count standard words like &#8216;ville&#8217; or &#8216;sncf&#8217;.</p>
<p>Functions frequently used by other modules:</p>
<blockquote>
<div><ul class="simple">
<li>mod_leven: a function to compute the distance between two
strings. It is based on the Levenshtein ratio.</li>
<li>clean: a function to clean string before comparisons</li>
</ul>
</div></blockquote>
<p>This module strongly relies on one other module:</p>
<blockquote>
<div><ul class="simple">
<li>Levenshtein: this module implements some standard algorithms
to compare strings, such as the Levenshtein distance</li>
</ul>
</div></blockquote>
<p>Simple examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;St-Etienne&quot; &quot;    &#39;</span><span class="p">)</span>
<span class="go">[&#39;saint&#39;, &#39;etienne&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;antibes sncf 2 (centre)&#39;</span><span class="p">)</span>
<span class="go">[&#39;antibes&#39;, &#39;centre&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mod_leven</span><span class="p">(</span><span class="s">&#39;antibes&#39;</span><span class="p">,</span> <span class="s">&#39;antibs&#39;</span><span class="p">)</span>
<span class="go">0.92...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mod_leven</span><span class="p">(</span><span class="s">&#39;Aéroport CDG  2&#39;</span><span class="p">,</span> <span class="s">&#39;aeroport-cdg&#39;</span><span class="p">)</span>
<span class="go">1.0</span>
</pre></div>
</div>
<dl class="function">
<dt id="GeoBases.LevenshteinUtils.clean">
<tt class="descclassname">GeoBases.LevenshteinUtils.</tt><tt class="descname">clean</tt><big>(</big><em>string</em><big>)</big><a class="reference internal" href="_modules/GeoBases/LevenshteinUtils.html#clean"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.LevenshteinUtils.clean" title="Permalink to this definition">¶</a></dt>
<dd><p>Global cleaning function which put
all previous ones together.</p>
<p>This function cleans the string to have a better comparison.
Different steps:</p>
<blockquote>
<div><ul class="simple">
<li>lower and strip (remove leading and trailing spaces/tabulations)</li>
<li>manage accentuated characters, parenthesis</li>
<li>properly split the string</li>
<li>handle common aliases, irrelevant words, numbers and spaces</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>string</strong> &#8211; the string to be processed</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the clean string</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;Paris&#39;</span><span class="p">)</span>
<span class="go">[&#39;paris&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;Paris ville&#39;</span><span class="p">)</span>
<span class="go">[&#39;paris&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;St-Etienne&#39;</span><span class="p">)</span>
<span class="go">[&#39;saint&#39;, &#39;etienne&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;Aix-Les   Bains&#39;</span><span class="p">)</span>
<span class="go">[&#39;aix&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;antibes sncf 2 (centre)&#39;</span><span class="p">)</span>
<span class="go">[&#39;antibes&#39;, &#39;centre&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.LevenshteinUtils.handle_accents">
<tt class="descclassname">GeoBases.LevenshteinUtils.</tt><tt class="descname">handle_accents</tt><big>(</big><em>string</em><big>)</big><a class="reference internal" href="_modules/GeoBases/LevenshteinUtils.html#handle_accents"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.LevenshteinUtils.handle_accents" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove accentuated characters in a word, and
replace them with non-accentuated ones.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>string</strong> &#8211; the string to be processed</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the unaccentuad string</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">handle_accents</span><span class="p">(</span><span class="s">&#39;être&#39;</span><span class="p">)</span>
<span class="go">&#39;etre&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">handle_accents</span><span class="p">(</span><span class="s">&#39;St-Etienne SNCF (Châteaucreux)&#39;</span><span class="p">)</span>
<span class="go">&#39;St-Etienne SNCF (Chateaucreux)&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.LevenshteinUtils.handle_alias">
<tt class="descclassname">GeoBases.LevenshteinUtils.</tt><tt class="descname">handle_alias</tt><big>(</big><em>strings</em><big>)</big><a class="reference internal" href="_modules/GeoBases/LevenshteinUtils.html#handle_alias"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.LevenshteinUtils.handle_alias" title="Permalink to this definition">¶</a></dt>
<dd><p>Some common words have different ways to be used.
This function normalize those, to have a better
comparison tool later.
For example, we can replace &#8216;st&#8217; by &#8216;saint&#8217;.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>strings</strong> &#8211; the list of words to be processed</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the list of words after normalization</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">handle_alias</span><span class="p">([</span><span class="s">&#39;st&#39;</span><span class="p">,</span> <span class="s">&#39;etienne&#39;</span><span class="p">,</span> <span class="s">&#39;SNCF&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">])</span>
<span class="go">[&#39;saint&#39;, &#39;etienne&#39;, &#39;SNCF&#39;, &#39;&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.LevenshteinUtils.handle_numbers_spaces">
<tt class="descclassname">GeoBases.LevenshteinUtils.</tt><tt class="descname">handle_numbers_spaces</tt><big>(</big><em>strings</em><big>)</big><a class="reference internal" href="_modules/GeoBases/LevenshteinUtils.html#handle_numbers_spaces"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.LevenshteinUtils.handle_numbers_spaces" title="Permalink to this definition">¶</a></dt>
<dd><p>Some words contains numbers irrelevant to string comparison.
This function remove those, to have a better
comparison tool later.
It also removes blanks which could have been left
during earlier removals.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>strings</strong> &#8211; the list of words to be processed</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the list of words number-free</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">handle_numbers_spaces</span><span class="p">([</span><span class="s">&#39;saint&#39;</span><span class="p">,</span> <span class="s">&#39;etienne&#39;</span><span class="p">,</span> <span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">])</span>
<span class="go">[&#39;saint&#39;, &#39;etienne&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.LevenshteinUtils.handle_parenthesis_info">
<tt class="descclassname">GeoBases.LevenshteinUtils.</tt><tt class="descname">handle_parenthesis_info</tt><big>(</big><em>string</em>, <em>parts=None</em><big>)</big><a class="reference internal" href="_modules/GeoBases/LevenshteinUtils.html#handle_parenthesis_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.LevenshteinUtils.handle_parenthesis_info" title="Permalink to this definition">¶</a></dt>
<dd><p>When a word contains parenthesis, this function picks
only the part <em>before</em> the parenthesis.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>string</strong> &#8211; the string to be processed</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the parenthesis-free string</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">handle_parenthesis_info</span><span class="p">(</span><span class="s">&#39;Lyon Part-Dieu (TGV)&#39;</span><span class="p">)</span>
<span class="go">&#39;Lyon Part-Dieu TGV&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">handle_parenthesis_info</span><span class="p">(</span><span class="s">&#39;Lyon Part-Dieu (TGV)&#39;</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;before&#39;</span><span class="p">])</span>
<span class="go">&#39;Lyon Part-Dieu&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">handle_parenthesis_info</span><span class="p">(</span><span class="s">&#39;(Sncf) City&#39;</span><span class="p">)</span>
<span class="go">&#39;Sncf City&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">handle_parenthesis_info</span><span class="p">(</span><span class="s">&#39;Lyon (Sncf) City&#39;</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="s">&#39;after&#39;</span><span class="p">])</span>
<span class="go">&#39;Sncf City&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">handle_parenthesis_info</span><span class="p">(</span><span class="s">&#39;St-Etienne SNCF (Chateaucreux)&#39;</span><span class="p">)</span>
<span class="go">&#39;St-Etienne SNCF Chateaucreux&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.LevenshteinUtils.handle_transparent">
<tt class="descclassname">GeoBases.LevenshteinUtils.</tt><tt class="descname">handle_transparent</tt><big>(</big><em>strings</em><big>)</big><a class="reference internal" href="_modules/GeoBases/LevenshteinUtils.html#handle_transparent"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.LevenshteinUtils.handle_transparent" title="Permalink to this definition">¶</a></dt>
<dd><p>Some words are often parts irrelevant to string comparison.
This function remove those, to have a better
comparison tool later.
For example, we can remove &#8216;ville&#8217; or &#8216;sncf&#8217;.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>strings</strong> &#8211; the list of words to be processed</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the list of words after normalization</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">handle_transparent</span><span class="p">([</span><span class="s">&#39;saint&#39;</span><span class="p">,</span> <span class="s">&#39;etienne&#39;</span><span class="p">,</span> <span class="s">&#39;sncf&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">])</span>
<span class="go">[&#39;saint&#39;, &#39;etienne&#39;, &#39;&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">handle_transparent</span><span class="p">([</span><span class="s">&#39;aix&#39;</span><span class="p">,</span> <span class="s">&#39;ville&#39;</span><span class="p">])</span>
<span class="go">[&#39;aix&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.LevenshteinUtils.is_sublist">
<tt class="descclassname">GeoBases.LevenshteinUtils.</tt><tt class="descname">is_sublist</tt><big>(</big><em>subL</em>, <em>L</em><big>)</big><a class="reference internal" href="_modules/GeoBases/LevenshteinUtils.html#is_sublist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.LevenshteinUtils.is_sublist" title="Permalink to this definition">¶</a></dt>
<dd><p>This function tests the inclusion of a list in another one.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sublst</strong> &#8211; the tested sub-list</li>
<li><strong>lst</strong> &#8211; the tested list</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a boolean</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">is_sublist</span><span class="p">([</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_sublist</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_sublist</span><span class="p">([],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>  <span class="c"># [] is a sub-list of everyone</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_sublist</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[])</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_sublist</span><span class="p">([</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_sublist</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span> <span class="c"># Order matter</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_sublist</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">is_sublist</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.LevenshteinUtils.mod_leven">
<tt class="descclassname">GeoBases.LevenshteinUtils.</tt><tt class="descname">mod_leven</tt><big>(</big><em>str1</em>, <em>str2</em>, <em>heuristic_inclusion=True</em>, <em>heuristic_inclusion_value=0.99</em><big>)</big><a class="reference internal" href="_modules/GeoBases/LevenshteinUtils.html#mod_leven"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.LevenshteinUtils.mod_leven" title="Permalink to this definition">¶</a></dt>
<dd><p>The main comparison function.
In fact, the real work has already been done previously,
with the cleaning function.</p>
<p>This function uses Levenshtein ratio to evaluate the
distance between the two strings. It is up to the user to
define which distance is acceptable for classic mispelling, but
from my point of view, 90% is fairly acceptable.</p>
<p>When we have a inclusion of one string in the other (list inclusion,
not possible to include partial words such as toul for toulon),
we put the ratio of similarity to 99%, this is heuristic.
Why not 100%? Because, if another entry in the base really match 100%,
this will probably be an even better match, such as:
orleans+gervais matches orleans with inclusion heuristic (so 99%),
but we also have the real orleans+gervais station in the base,
and this one is a 100% match, so this will take over as the best match.</p>
<p>Sometimes rare cases of high ratio are not relevant.
For example, Toul match Toulon with 80%, but this
is wrong, and may be handled with a cache to manage exceptional
failing by the graph module, or by upping the acceptance limit.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>str1</strong> &#8211; the first string to compare</li>
<li><strong>str2</strong> &#8211; the second string to compare</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the distance, which is a ratio (0% to 100%)</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mod_leven</span><span class="p">(</span><span class="s">&#39;antibes&#39;</span><span class="p">,</span> <span class="s">&#39;antibs&#39;</span><span class="p">)</span>
<span class="go">0.92...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mod_leven</span><span class="p">(</span><span class="s">&#39;toul&#39;</span><span class="p">,</span> <span class="s">&#39;toulon&#39;</span><span class="p">)</span>
<span class="go">0.8...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mod_leven</span><span class="p">(</span><span class="s">&#39;Aéroport CDG  2 TGV&#39;</span><span class="p">,</span> <span class="s">&#39;aeroport-cdg&#39;</span><span class="p">)</span> <span class="c"># Inclusion</span>
<span class="go">0.9...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mod_leven</span><span class="p">(</span><span class="s">&#39;Bains les bains&#39;</span><span class="p">,</span> <span class="s">&#39;Tulle&#39;</span><span class="p">)</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>Tweaking behavior.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mod_leven</span><span class="p">(</span><span class="s">&#39;Aéroport CDG  2 TGV&#39;</span><span class="p">,</span> <span class="s">&#39;aeroport-cdg&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="c"># No inclusion</span>
<span class="go">0.85...</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.LevenshteinUtils.split_separators">
<tt class="descclassname">GeoBases.LevenshteinUtils.</tt><tt class="descname">split_separators</tt><big>(</big><em>string</em><big>)</big><a class="reference internal" href="_modules/GeoBases/LevenshteinUtils.html#split_separators"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.LevenshteinUtils.split_separators" title="Permalink to this definition">¶</a></dt>
<dd><p>When a word contains different separators, this function
split the word using all separators.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>string</strong> &#8211; the string to be processed</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the list of words after splitting</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">split_separators</span><span class="p">(</span><span class="s">&#39;Lyon Part-Dieu&#39;</span><span class="p">)</span>
<span class="go">[&#39;Lyon&#39;, &#39;Part&#39;, &#39;Dieu&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">split_separators</span><span class="p">(</span><span class="s">&#39;St-Etienne SNCF &#39;</span><span class="p">)</span>
<span class="go">[&#39;St&#39;, &#39;Etienne&#39;, &#39;SNCF&#39;, &#39;&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="GeoBases.LevenshteinUtils.str_lowercase">
<tt class="descclassname">GeoBases.LevenshteinUtils.</tt><tt class="descname">str_lowercase</tt><big>(</big><em>string</em><big>)</big><a class="reference internal" href="_modules/GeoBases/LevenshteinUtils.html#str_lowercase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#GeoBases.LevenshteinUtils.str_lowercase" title="Permalink to this definition">¶</a></dt>
<dd><p>Lower case adapted for str type.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;Étaples&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="c"># Fail!</span>
<span class="go">Étaples</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">str_lowercase</span><span class="p">(</span><span class="s">&#39;Étaples&#39;</span><span class="p">))</span> <span class="c"># Win!</span>
<span class="go">étaples</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">GeoBases Package</a><ul>
<li><a class="reference internal" href="#id1"><tt class="docutils literal"><span class="pre">GeoBases</span></tt> Package</a></li>
<li><a class="reference internal" href="#module-GeoBases.GeoBaseModule"><tt class="docutils literal"><span class="pre">GeoBaseModule</span></tt> Module</a></li>
<li><a class="reference internal" href="#module-GeoBases.GeoGridModule"><tt class="docutils literal"><span class="pre">GeoGridModule</span></tt> Module</a></li>
<li><a class="reference internal" href="#module-GeoBases.GeoUtils"><tt class="docutils literal"><span class="pre">GeoUtils</span></tt> Module</a></li>
<li><a class="reference internal" href="#module-GeoBases.LevenshteinUtils"><tt class="docutils literal"><span class="pre">LevenshteinUtils</span></tt> Module</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="GeoBaseMain.html"
                        title="previous chapter">GeoBaseMain Module</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/GeoBases.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="GeoBaseMain.html" title="GeoBaseMain Module"
             >previous</a> |</li>
        <li><a href="index.html">GeoBases 4 documentation</a> &raquo;</li>
          <li><a href="modules.html" >API documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Alex Prengere.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>